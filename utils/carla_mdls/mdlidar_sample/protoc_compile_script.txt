#! /bin/bash

set -e

# SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
# pushd "$SCRIPT_DIR" >/dev/null

# PROTOBUF_SRC_DIR=/path/to/mdlidar_example/msg/
PROTOBUF_SRC_DIR=./msg/
PROTOBUF_CPP_OUT_DIR=src_cpp
PROTOBUF_PY_OUT_DIR=src_py
BASENAME=mdlidar

if [ "$1" == "--clean" ]; then
  # Delete existing ones.
  rm -f ${PROTOBUF_CPP_OUT_DIR}/*.pb.h ${PROTOBUF_CPP_OUT_DIR}/*.pb.cc
  exit 0
fi

# PROTOC=./protobuf/protobuf-install/bin/protoc
PROTOC=/dg-hl-fast/codes/OpenPCDet/utils/carla_mdls/mdlidar_sample/protobuf/bin/protoc

if [[ ! -f $PROTOC ]]; then
  echo >&2 "ERROR: Missing protobuf compiler."
  exit 1
fi

echo "Compiling ${BASENAME}.proto..."

${PROTOC} \
    -I=${PROTOBUF_SRC_DIR} \
    --cpp_out=${PROTOBUF_CPP_OUT_DIR} \
    --python_out=${PROTOBUF_PY_OUT_DIR} \
  ${PROTOBUF_SRC_DIR}/${BASENAME}.proto

popd >/dev/null
echo "done."